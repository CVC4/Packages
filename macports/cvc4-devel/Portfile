# $Id$

PortSystem          1.0

name                cvc4-devel
version             2013-12-18
revision            0
categories          math devel
platforms           darwin
maintainers         cs.nyu.edu:mdeters
description         First order formula validity checker (version 4)
long_description    CVC4 is a tool for determining the satisfiability of a first order formula \
                    modulo a first order theory (or a combination of such theories). It is the \
                    fourth in the Cooperating Validity Checker family of tools (CVC, CVC Lite, \
                    CVC3) but does not directly incorporate code from any previous version. \
                    \
                    CVC4 is intended to be an open and extensible SMT engine. It can be used \
                    as a stand-alone tool or as a library. It has been designed to increase \
                    the performance and reduce the memory overhead of its predecessors. \
                    \
                    This version is a developmental snapshot release.  For a stable version, \
                    please use the "cvc4" package instead.
license             GPL
homepage            http://cvc4.cs.nyu.edu/
master_sites        http://cvc4.cs.nyu.edu/builds/src/unstable/
distname            cvc4-${version}
checksums           rmd160 1085f3bca069a5c4d6ca41f365c352d6cb95fe0c \
                    sha256 dbf06998f7447e071303d82325dc7c3c4294071b3b38599159a168c45c2c266d
default_variants    +no_static
depends_lib         port:gmp \
                    port:cln \
                    port:readline
depends_build       port:boost \
                    port:doxygen \
                    bin:curl:curl \
                    bin:bash:bash \
                    bin:awk:gawk
conflicts           cvc4 \
                    cvc4-kind-devel
configure.args      --enable-static --enable-shared --with-build=production \
                    --with-cln --with-compat --with-readline \
                    --disable-doxygen-pdf --enable-doxygen-dot \
                    --with-antlr-dir="${worksrcpath}/antlr-3.4" \
                    ANTLR="${worksrcpath}/antlr-3.4/bin/antlr3" \
                    CXXFLAGS=-stdlib=libstdc++ \
                    CPPFLAGS=-stdlib=libstdc++
# --enable-language-bindings=c,java
# --with-portfolio
test.run            yes

variant no_static description {Do not build static libraries} {
    configure.args-delete --enable-static
}

variant debug description {Build a "debug" copy} {
    configure.args-delete --with-build=production
    configure.args-append --with-build=debug
}

pre-configure {
    # Mavericks requires -stdlib=libstdc++ here
    system "if test ${os.major} -ge 13; then export CPPFLAGS=\"\$CPPFLAGS -stdlib=libstdc++\"; fi; MACHINE_TYPE=`${worksrcpath}/config/config.guess | cut -f1 -d-` ANTLR_CONFIGURE_ARGS=--disable-abiflags ${worksrcpath}/contrib/get-antlr-3.4"
}

post-build {
    system "make -C \"${worksrcpath}\" doc"
}

post-destroot {
    file mkdir "${destroot}${prefix}/share/doc/${name}/doxygen"
    file copy "${worksrcpath}/doc/doxygen/html" \
          "${destroot}${prefix}/share/doc/${name}/doxygen/html"
    system "make -C \"${worksrcpath}\" install-examples DESTDIR=\"${destroot}\""
}

livecheck.type          regex
livecheck.url           ${master_sites}
livecheck.regex         cvc4-(\[0-9.-\]+)\\.tar\\.gz
